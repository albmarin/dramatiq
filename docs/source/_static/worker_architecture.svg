<svg xmlns="http://www.w3.org/2000/svg" id="mermaidChart0" width="100%" height="100%" viewBox="-50 -10 1373.203 906" style="max-width:1373.203125px"><style>.actor{stroke:#ccf;fill:#ececff}text.actor{fill:#000;stroke:none}.actor-line{stroke:gray}.messageLine0{marker-end:&quot;url(#arrowhead)&quot;}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:&quot;2 2&quot;;stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#ccf;fill:#ececff}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:&quot;2 2&quot;;marker-end:&quot;url(#arrowhead)&quot;;stroke:#ccf}svg{color:#000;font:400 16px Menlo,Monaco,&quot;Courier New&quot;,monospace}</style><g><line id="actor0" x1="75" x2="75" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="0" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="75" y="23" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="75">ConsumerThre</tspan><tspan x="75" dy="19">ad(&quot;default&quot;)</tspan></text></g><g><line id="actor1" x1="275" x2="275" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="200" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="275" y="32.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="275" dy="0">RabbitMQ</tspan></text></g><g><line id="actor2" x1="475" x2="475" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="400" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="475" y="23" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="475">WorkQueue in</tspan><tspan x="475" dy="19">memory</tspan></text></g><g><line id="actor3" x1="675" x2="675" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="600" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="675" y="23" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="675">AcksQueue in</tspan><tspan x="675" dy="19">memory</tspan></text></g><g><line id="actor4" x1="875" x2="875" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="800" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="875" y="32.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="875" dy="0">WorkerThread1</tspan></text></g><g><line id="actor5" x1="1075" x2="1075" y1="5" y2="895" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="1000" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1075" y="32.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="1075" dy="0">WorkerThread2</tspan></text></g><defs><marker id="arrowhead" markerHeight="4" markerWidth="6" orient="auto" refX="5" refY="2"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerHeight="8" markerWidth="15" orient="auto" refX="16" refY="4"><path fill="#000" stroke="#000" stroke-width="1" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray:0,0"/><path fill="none" stroke="#000" stroke-width="1" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray:0,0"/></marker></defs><g><text x="175" y="118" class="messageText" style="text-anchor:middle">get_message(queue_name=&quot;default&quot;, block=True)</text><line x1="75" x2="275" y1="125" y2="125" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><text x="172.5" y="153" class="messageText" style="text-anchor:middle">Message(id=1, {...})</text><line x1="270" x2="75" y1="160" y2="160" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1" style="stroke-dasharray:3,3;fill:none"/></g><g><text x="275" y="188" class="messageText" style="text-anchor:middle">put_work(Message(id=1, {...}))</text><line x1="75" x2="475" y1="195" y2="195" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><text x="375" y="248" class="messageText" style="text-anchor:middle">get_pending_ack()</text><line x1="75" x2="675" y1="255" y2="255" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><text x="375" y="283" class="messageText" style="text-anchor:middle">Message(id=1, {...})</text><line x1="675" x2="75" y1="290" y2="290" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1" style="stroke-dasharray:3,3;fill:none"/></g><g><text x="172.5" y="318" class="messageText" style="text-anchor:middle">ack_message(id=1)</text><line x1="75" x2="270" y1="325" y2="325" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><line x1="65" x2="685" y1="205" y2="205" class="loopLine"/><line x1="685" x2="685" y1="205" y2="335" class="loopLine"/><line x1="65" x2="685" y1="335" y2="335" class="loopLine"/><line x1="65" x2="65" y1="205" y2="335" class="loopLine"/><polygon points="65 205 115 205 115 218 106.6 225 65 225" class="labelBox"/><text x="72.5" y="220" fill="#000" class="labelText"><tspan x="72.5" fill="#000">loop</tspan></text><text x="375" y="220" fill="#000" class="loopText" style="text-anchor:middle"><tspan x="375" fill="#000">[ while pending acks ]</tspan></text></g><g><line x1="55" x2="695" y1="75" y2="75" class="loopLine"/><line x1="695" x2="695" y1="75" y2="345" class="loopLine"/><line x1="55" x2="695" y1="345" y2="345" class="loopLine"/><line x1="55" x2="55" y1="75" y2="345" class="loopLine"/><polygon points="55 75 105 75 105 88 96.6 95 55 95" class="labelBox"/><text x="62.5" y="90" fill="#000" class="labelText"><tspan x="62.5" fill="#000">loop</tspan></text><text x="375" y="90" fill="#000" class="loopText" style="text-anchor:middle"><tspan x="375" fill="#000">[ while running, read messages off the broker and put them on the work queue ]</tspan></text></g><g><text x="675" y="423" class="messageText" style="text-anchor:middle">get_work(block=True)</text><line x1="875" x2="475" y1="430" y2="430" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><text x="675" y="458" class="messageText" style="text-anchor:middle">Message(id=2, { ... })</text><line x1="475" x2="875" y1="465" y2="465" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1" style="stroke-dasharray:3,3;fill:none"/></g><g><text x="875" y="493" class="messageText" style="text-anchor:middle">process_message(Message(id=2, {...}))</text><path stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 875,500 C 935,490 935,530 875,520" class="messageLine0" style="fill:none"/></g><g><text x="775" y="558" class="messageText" style="text-anchor:middle">ack_message(Message(id=2, { ... }))</text><line x1="875" x2="675" y1="565" y2="565" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><line x1="465" x2="1063.203" y1="380" y2="380" class="loopLine"/><line x1="1063.203" x2="1063.203" y1="380" y2="575" class="loopLine"/><line x1="465" x2="1063.203" y1="575" y2="575" class="loopLine"/><line x1="465" x2="465" y1="380" y2="575" class="loopLine"/><polygon points="465 380 515 380 515 393 506.6 400 465 400" class="labelBox"/><text x="472.5" y="395" fill="#000" class="labelText"><tspan x="472.5" fill="#000">loop</tspan></text><text x="764.102" y="395" fill="#000" class="loopText" style="text-anchor:middle"><tspan x="764.102" fill="#000">[ while running, process work ]</tspan></text></g><g><text x="775" y="648" class="messageText" style="text-anchor:middle">get_work(block=True)</text><line x1="1075" x2="475" y1="655" y2="655" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><text x="775" y="683" class="messageText" style="text-anchor:middle">Message(id=1, { ... })</text><line x1="475" x2="1075" y1="690" y2="690" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1" style="stroke-dasharray:3,3;fill:none"/></g><g><text x="1075" y="718" class="messageText" style="text-anchor:middle">process_message(Message(id=1, {...}))</text><path stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1075,725 C 1135,715 1135,755 1075,745" class="messageLine0" style="fill:none"/></g><g><text x="875" y="783" class="messageText" style="text-anchor:middle">ack_message(Message(id=1, { ... }))</text><line x1="1075" x2="675" y1="790" y2="790" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0" style="fill:none"/></g><g><line x1="465" x2="1263.203" y1="605" y2="605" class="loopLine"/><line x1="1263.203" x2="1263.203" y1="605" y2="800" class="loopLine"/><line x1="465" x2="1263.203" y1="800" y2="800" class="loopLine"/><line x1="465" x2="465" y1="605" y2="800" class="loopLine"/><polygon points="465 605 515 605 515 618 506.6 625 465 625" class="labelBox"/><text x="472.5" y="620" fill="#000" class="labelText"><tspan x="472.5" fill="#000">loop</tspan></text><text x="864.102" y="620" fill="#000" class="loopText" style="text-anchor:middle"><tspan x="864.102" fill="#000">[ while running, process work ]</tspan></text></g><g><line x1="455" x2="1273.203" y1="355" y2="355" class="loopLine"/><line x1="1273.203" x2="1273.203" y1="355" y2="810" class="loopLine"/><line x1="455" x2="1273.203" y1="810" y2="810" class="loopLine"/><line x1="455" x2="455" y1="355" y2="810" class="loopLine"/><line x1="455" x2="1273.203" y1="585" y2="585" class="loopLine" style="stroke-dasharray:3,3"/><polygon points="455 355 505 355 505 368 496.6 375 455 375" class="labelBox"/><text x="462.5" y="370" fill="#000" class="labelText"><tspan x="462.5" fill="#000">alt</tspan></text><text x="864.102" y="370" fill="#000" class="loopText" style="text-anchor:middle"><tspan x="864.102" fill="#000">[ concurrently ]</tspan></text></g><g><rect width="150" height="65" x="0" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="75" y="853" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="75">ConsumerThre</tspan><tspan x="75" dy="19">ad(&quot;default&quot;)</tspan></text></g><g><rect width="150" height="65" x="200" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="275" y="862.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="275" dy="0">RabbitMQ</tspan></text></g><g><rect width="150" height="65" x="400" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="475" y="853" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="475">WorkQueue in</tspan><tspan x="475" dy="19">memory</tspan></text></g><g><rect width="150" height="65" x="600" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="675" y="853" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="675">AcksQueue in</tspan><tspan x="675" dy="19">memory</tspan></text></g><g><rect width="150" height="65" x="800" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="875" y="862.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="875" dy="0">WorkerThread1</tspan></text></g><g><rect width="150" height="65" x="1000" y="830" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1075" y="862.5" alignment-baseline="central" class="actor" dominant-baseline="central" style="text-anchor:middle"><tspan x="1075" dy="0">WorkerThread2</tspan></text></g></svg>